from random import seed
from random import randint
import sys

seed(22)

class Grupos():
    def  __init__(self,lista_paises) -> None:
        self.lista_paises=lista_paises
        self.lista_paisesxgrupo=[]
        self.gruposfinal={"Grupo 1":[] ,"Grupo 2":[],"Grupo 3":[],"Grupo 4":[], "Grupo 5":[],
          "Grupo 6": [], "Grupo 7":[], "Grupo 8":[] }
    
    def acomodando_cabezas_serie(self, object, grupo:int,ran):
        self.lista_paisesxgrupo.append([object])
        self.gruposfinal[f"Grupo {grupo}"]=[object.nombre]
        del self.lista_paises[0][ran]
        return None

    def validando_grupo(self,confe,grupo,bombo)->bool:
        try:
            confe_grupo=[self.lista_paisesxgrupo[grupo-1][elementos].confederacion for elementos
                 in range(len(self.lista_paisesxgrupo[grupo-1]))]
        except:
            print(f'No se pudo acomodar ultimo equipo por ser de la confederacion {confe}' )
            sys.exit('Error en configuracion de grupos')
        if confe == 'UEFA' and  len(self.lista_paisesxgrupo[grupo-1]) < bombo:
            if confe_grupo.count('UEFA')<2:
                return True
        elif confe not in confe_grupo and  len(self.lista_paisesxgrupo[grupo-1]) < bombo:
            return True
        print(f'---No se puede acomodar en grupo {grupo }')
        return False

    def acomodando_equipoengrupo(self,object,grupo,bombo,ran):
        equipo=object.nombre
        bol=self.validando_grupo(object.confederacion,grupo,bombo)
        if bol:
            self.lista_paisesxgrupo[grupo-1].append(object)
            self.gruposfinal[f"Grupo {grupo}"].append(equipo)
            del self.lista_paises[bombo-1][ran]
            print(f'{equipo} va a grupo {grupo}')
            print(self.gruposfinal)
            return grupo
        return self.acomodando_equipoengrupo(object,grupo+1,bombo,ran)
        



    def acomodando_bombo(self,bombo:int):
        print(f'****************************************** Sorteando equipos del bombo {bombo}*****************************')
        i=0
        while len(self.lista_paises[bombo-1])>0:
            if len(self.lista_paisesxgrupo[i]) < bombo:
                value=randint(0,len(self.lista_paises[bombo-1])-1)
                print(f'(*) En sorteo sale {self.lista_paises[bombo-1][value].nombre}')
                k=self.acomodando_equipoengrupo(self.lista_paises[bombo-1][value],i+1,bombo,value)
                if i==k:
                    i=i+1
            else:
                i=i+1


                

    def __call__(self):
        # asignando el grupo 1 al local
        for i in range(7):
            if self.lista_paises[0][i].local:
                self.acomodando_cabezas_serie(self.lista_paises[0][i],1,0) 
        print(self.gruposfinal)
        # acomodando cabezas de serie en los 8 grupos
        print('*******Acomodando cabezas de serie**********')
        for i in range(7):
            value=randint(0,len(self.lista_paises[0])-1)
            self.acomodando_cabezas_serie(self.lista_paises[0][value],i+2,value)
            print(self.gruposfinal)
        for i in range(2,5):
            self.acomodando_bombo(i)
        print('El sorteo tuvo exito')
        return self.gruposfinal
